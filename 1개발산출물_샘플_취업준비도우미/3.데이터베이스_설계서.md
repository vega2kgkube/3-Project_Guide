# **데이터베이스 설계서**

## **1\. 데이터베이스 구성**

* RDBMS: PostgreSQL, h2-database  
* Vector DB: FAISS , ChromaDB 

## **2\. 주요 테이블**

### **2.1 users (사용자)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 사용자 ID |
| username | VARCHAR(255) | NOT NULL, UNIQUE | 사용자명 |
| email | VARCHAR(255) | NOT NULL, UNIQUE | 이메일 |
| password | VARCHAR(255) | NOT NULL | 비밀번호 (암호화 된 값을 저장장) |

### 

### **2.2 news (뉴스)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 뉴스 ID |
| company\_name | VARCHAR(255) | NOT NULL | 언론사명 |
| title | VARCHAR(255) | NOT NULL | 뉴스 제목 |
| contents | TEXT | NOT NULL | 뉴스 본문 |
| publish\_date | DATE | NOT NULL | 발행일 |
| created\_at | TIMESTAMP | NOT NULL | 생성 시간 |

### **2.3. chat\_session (채팅 세션)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 세션 ID |
| user\_id | BIGINT | FK (chat\_sesison 테이블 참조) | 사용자 ID |
| news\_id | BIGINT | FK(news 테이블 참조) | 뉴스 ID |
| created\_at | TIMESTAMP | NOT NULL | 세션 생성 시간 |

### 

### **2\.4\. chat\_message (채팅 메시지)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 메시지 ID |
| chat\_session\_id | BIGINT | FK (chat\_session 테이블 참조) | 채팅 세션 ID |
| content | TEXT | NOT NULL | 메시지 내용 |
| type | VARCHAR(255) | NOT NULL | 메시지 타입 (human/ai) |
| created\_at | TIMESTAMP | NOT NULL | 메시지 생성 시간 |

### **2\.5\. email\_verification (이메일 인증)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 인증 ID |
| email | VARCHAR(255) | NOT NULL | 이메일 주소 |
| code | VARCHAR(255) | NOT NULL | 인증 코드 |
| expires\_at | TIMESTAMP | NOT NULL | 만료 시간 |
| verified | BOOLEAN | NOT NULL | 인증 완료 여부 |
| created\_at | TIMESTAMP | NOT NULL | 생성 시간 |

### **2\.6\. refresh\_token (리프레시 토큰)**

| 컬럼명 | 타입 | 제약조건 | 설명 |
| ----- | ----- | ----- | ----- |
| id | BIGINT | PK | 토큰 ID |
| user\_id | BIGINT | NOT NULL,  UNIQUE(1:1 관계), FK(users 테이블 참조) | 사용자 ID |
| refresh\_token | TEXT | NOT NULL | 리프레시 토큰 값 |
| created\_at | TIMESTAMP | NOT NULL | 생성 시간 |
| expires\_at | TIMESTAMP | NOT NULL | 만료 시간 |

## **3\. 관계**

* **User (1:N) ChatSession**: 한 사용자는 여러 채팅 세션을 가질 수 있음.   
* **News (1:N) ChatSession**: 하나의 뉴스는 여러 채팅 세션에서 사용될 수 있음.   
* **ChatSession (1:N) ChatMessage**: 하나의 채팅 세션은 여러 채팅 메시지를 포함.   
* **User (1:1) RefreshToken**: 한 사용자는 하나의 유효한 리프레시 토큰을 가짐. (논리적 관계)  
* **EmailVerification (N:1) User**: 여러 이메일 인증 시도 기록이 한 사용자 이메일에 해당할 수 있음. (이메일 기반 인증이므로 직접적인 FK는 아님)

## 

## **4\. 벡터 DB 설정**

* **벡터 DB 시스템:** ChromaDB (HTTP 클라이언트 모드)  
  * chromadb.HttpClient(host="localhost", port=8001)를 통해 연결.  
  *  (설정 파일: llm-service/chat\_langgraph.py, llm-service/main.py)  
* **임베딩 모델:** Ollama tinyllama:1.1b  
  * OllamaEmbeddings(model="tinyllama:1.1b")를 사용하여 문서 내용을 벡터로 변환. (설정 파일: llm-service/chat\_langgraph.py의 get\_embeddings() 메서드드)  
* **유사도 측정 방식:** L2 거리 (Euclidean Distance)  
  * ChromaDB의 기본 유사도 측정 방식이며, IndexFlatL2와 같은 특정 인덱스 타입은 클라이언트 코드에서 직접 설정되지 않았음.   
* **청크 크기:** 1000자 (문서 분할 단위)  
  * RecursiveCharacterTextSplitter(chunk\_size=1000, ...)로 설정.  
  *  (설정 파일: llm-service/main.py)  
* **오버랩:** 200자 (청크 간 중복)  
  * RecursiveCharacterTextSplitter(..., chunk\_overlap=200)로 설정.  
  *  (설정 파일: llm-service/main.py)

