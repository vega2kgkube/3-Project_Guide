# **Backend 개발 명세서**

## **1\. 기술 스택**

* **언어: Java 17**  
* **프레임워크: Spring Boot 3.5.3**  
* **데이터베이스: H2 (테스트/개발용), PostgreSQL (운영용)**  
* **데이터 접근: Spring Data JPA**  
* **보안: Spring Security, JWT(Java Web Token)**  
* **API 통신: RestClient (Spring 6+), WebFlux (비동기 통신 지원)**  
* **API 문서화: Springdoc (Swagger/OpenAPI)**  
* **배포/운영: Docker, Docker Compose**  
* **기타: Lombok, Spring Mail (이메일 인증), Validation**

## **2\. 프로젝트 구조**

back/                                                 
├── src/main/  
│       ├── java/  
│       │   └── com/alreadyemployee/alreadyemployee/  
│       │       ├── chat/                           \# 채팅 기능 관련 모듈  
│       │       │   ├── controller/                 \# 채팅 관련 REST API 엔드포인트 정의  
│       │       │   ├── service/                    \# 채팅 비즈니스 로직 및 외부 LLM 연동 처리  
│       │       │   ├── repository/                 \# 채팅 데이터베이스 접근 (Spring Data JPA)  
│       │       │   ├── entity/                     \# 채팅 관련 JPA 엔티티 (DB 테이블 매핑)  
│       │       │   └── dto/                        \# 채팅 관련 데이터 전송 객체 (요청/응답)  
│       │       ├── news/                           \# 뉴스 기능 관련 모듈  
│       │       │   ├── controller/                 \# 뉴스 관련 REST API 엔드포인트 정의  
│       │       │   ├── service/                    \# 뉴스 비즈니스 로직  
│       │       │   ├── repository/                 \# 뉴스 데이터베이스 접근 (Spring Data JPA)  
│       │       │   ├── entity/                     \# 뉴스 관련 JPA 엔티티  
│       │       │   └── dto/                        \# 뉴스 관련 데이터 전송 객체  
│       │       ├── user/                           \# 사용자(인증/인가) 기능 관련 모듈  
│       │       │   ├── controller/                 \# 사용자 관련 REST API 엔드포인트 정의  
│       │       │   ├── service/                    \# 사용자 비즈니스 로직 및 인증/인가 처리  
│       │       │   ├── repository/                 \# 사용자 데이터베이스 접근 (Spring Data JPA)  
│       │       │   ├── entity/                     \# 사용자 관련 JPA 엔티티  
│       │       │   └── dto/                        \# 사용자 관련 데이터 전송 객체  
│       │       ├── jwt/                            \# JWT 토큰 생성, 검증 및 관련 필터  
│       │       ├── exception/                      \# 전역 예외 처리 및 커스텀 예외 정의  
│       │       └── config/                         \# 설정 (Security, RestClient, Swagger 등)  
│       │  
│       └── resources/  
│           ├── application.properties              \# 공통 애플리케이션 설정 및 기본 프로필  
│           ├── application-prod.properties         \# 운영(production) 환경별 설정  
│           └── application-test.properties         \# 테스트(test) 환경별 설정  
│  
├── build.gradle                                    \# Gradle 빌드 도구 설정 파일  
├── Dockerfile                                      \# Docker 이미지 빌드 설정 파일  
└── docker-compose.yml                              \# Docker Compose 설정 파일

## **3\. 주요 설정**

\# application.properties  
spring.config.import\=optional:file:.env\[.properties\]  
spring.application.name\=alreadyemployee  
jwt.secret\=${JWT\_SECRET}  
spring.profiles.active\=test

spring.mail.host\=smtp.gmail.com  
spring.mail.port\=587  
spring.mail.username\=${MAIL\_USERNAME}  
spring.mail.password\=${MAIL\_PASSWORD}  
spring.mail.properties.mail.smtp.auth\=true  
spring.mail.properties.mail.smtp.starttls.enable\=true

spring.servlet.multipart.max-file-size\=1000MB  
spring.servlet.multipart.max-request-size\=1000MB  
spring.servlet.multipart.file-size-threshold\=200MB  
spring.servlet.multipart.enabled\=true

\# application-prod.properties  
llm.base-url\=http://llm-svc:8000

spring.jpa.hibernate.ddl-auto\=update  
spring.jpa.show-sql\=true

\# application-test.properties  
llm.base-url\=http://localhost:8000

spring.datasource.url\=jdbc:h2:mem:alreadyDB  
spring.datasource.driver-class-name\=org.h2.Driver  
spring.datasource.username\=sa  
spring.datasource.password\=1234

spring.jpa.hibernate.ddl-auto\=update  
spring.jpa.show-sql\=true  
spring.jpa.properties.hibernate.dialect\=org.hibernate.dialect.H2Dialect

spring.h2.console.enabled\=true  
spring.h2.console.path\=/h2-console

fastapi.server.url\=http://localhost:8000

## **4\. 주요 클래스**

### **4.1 Entity** 

### **데이터베이스 테이블과 매핑되는 객체**

* ### **User**: 사용자 정보를 나타내는 엔티티.

* **News**: 뉴스 기사 정보를 나타내는 엔티티.  
* **ChatSession**: 사용자-뉴스 간의 채팅 세션을 나타내는 엔티티.  
* **ChatMessage**: 채팅 세션 내의 개별 메시지(사용자 질문, AI 답변)를 나타내는 엔티티.  
* **RefreshToken**: 사용자 인증을 위한 리프레시 토큰 정보를 나타내는 엔티티.  
* **EmailVerification**: 이메일 인증 코드 및 상태를 나타내는 엔티티.

### **4.2 Controller**

**클라이언트의 HTTP 요청을 받아 처리하고 응답을 반환하는 REST API 엔드포인트**

* **UserController**: 사용자(회원가입, 로그인, 토큰 재발급, 이메일 인증) 관련 API를 처리.  
* **NewsController**: 뉴스 기사 조회 및 추가 관련 API를 처리.  
* **ChatController**: AI 기반 채팅 및 뉴스 요약 관련 API를 처리.

### **4.3 Service**

* **UserService**: 사용자 관련 비즈니스 로직 (회원가입, 로그인, 이메일 인증 등).  
* **NewsService**: 뉴스 관련 비즈니스 로직 (뉴스 조회, 추가 등).  
* **ChatService**: 채팅 메시지 저장 및 뉴스 정보 조회 등 채팅 관련 핵심 비즈니스 로직.  
* **ChatProxyService**: 외부 langchain (FastAPI) 서버와의 통신을 대리하고, 요청 데이터를 가공하는 프록시 역할.  
* **RefreshTokenService**: 리프레시 토큰의 저장, 조회, 유효성 검증 등 토큰 관리 로직.  
* **CustomUserDetailsService**: Spring Security에서 사용자 정보를 로드하는 역할.

### **4.4 Repository**

* UserRepository: User 엔티티에 대한 데이터 접근.  
* NewsRepository: News 엔티티에 대한 데이터 접근.  
* ChatSessionRepository: ChatSession 엔티티에 대한 데이터 접근.  
* ChatMessageRepository: ChatMessage 엔티티에 대한 데이터 접근.  
* RefreshTokenRepository: RefreshToken 엔티티에 대한 데이터 접근.  
* EmailVerificationRepository: EmailVerification 엔티티에 대한 데이터 접근.

## 

## 

## **5\. 보안 구현**

* **JWT 토큰 인증:** JWT (Access Token, Refresh Token) 기반의 사용자 인증 및 인가 시스템 구현.  
* **Spring Security 설정:** Spring Security를 활용하여 전반적인 보안 필터 체인, 권한 부여, 세션 관리 (무상태) 등을 설정.  
* **CORS 설정:** CORS (Cross-Origin Resource Sharing) 설정을 통해 프론트엔드와의 교차 출처 요청을 허용.

  ## **6\. AI 모듈 연동**

* **RestClient 설정:** Spring RestClient를 이용하여 외부 langchain (LLM) 서버와의 HTTP 통신을 설정하고 관리.  
* **에러 핸들링:** 외부 langchain AI 서버 통신 시 발생할 수 있는 네트워크 오류, HTTP 상태 코드 오류 등에 대한 예외 처리 구현.

  ## **7\. 파일 처리**

* **MultipartFile 업로드:** 클라이언트로부터 multipart/form-data 형식으로 MultipartFile을 받아 외부 langchain 서버로 직접 전달하는 기능 구현.  
* **파일 형식 처리:** (백엔드에서 직접 처리하지 않음) 업로드된 파일의 실제 처리 및 지원 형식 검증은 연동된 langchain 서버에서 담당. 

  ## **8\. 예외 처리**

* **GlobalExceptionHandler:** @RestControllerAdvice를 사용하여 애플리케이션 전반의 예외를 중앙에서 처리하고, 표준화된 응답 형식 (ErrorResponse, SuccessResponse)을 제공.  
* **Custom Exception 클래스:** 비즈니스 로직에서 발생하는 특정 오류를 명확하게 구분하기 위한 BusinessException 및 ErrorCode (enum) 정의.

  ## **9\. 빌드 및 배포**

* **Gradle 빌드:** Gradle 빌드 도구를 사용하여 프로젝트 의존성을 관리하고 실행 가능한 JAR 파일을 생성.  
* **Docker 설정:** Docker를 활용하여 애플리케이션을 컨테이너화 (Dockerfile)하고, 데이터베이스와 함께 다중 서비스 환경을 구성 (docker-compose.yml).

